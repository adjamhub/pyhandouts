# uv

`uv` Ã¨ un package and project manager scritto in Rust per i progetti Python. `uv` Ã¨ pensato per essere una soluzione *all-in-one*
ovvero essere l'unico strumento da utilizzare per:

- scaricare pacchetti da *PyPi* (sostituisce `pip`)
- gestire ambienti virtuali (sostituisce `venv`)
- installare (copie) di Python stesso (sostituisce `pyenv`)
- gestire progetti e le loro dipendenze (sostituisce `pip-tools`, `poetry`, etc...)
- utilizzare ambienti e tools di test e di sviluppo (sostituisce `pipx`, etc... )
- creare pacchetti distribuibili (sostituisce `poetry`, etc...)
- pubblicare pacchetti su *PyPi* (sostituisce `twine`)

In buona sostanza, `uv` Ã¨ l'unico strumento che dovremo imparare ad utilizzare per fare alcune o tutte queste cose.
E non mi sembra neanche uno strumento difficile da utilizzare :smile:


## Installare uv

Su **Windows** puoi utilizzare l'installer di rete. Ti basta aprire il terminale e copiaincollare:

``` bash title="Comando powershell su Windows"
powershell -ExecutionPolicy ByPass -c "irm https://astral.sh/uv/install.ps1 | iex"
```

Analoga cosa su **MacOS**, apri il terminale ed esegui:

``` bash title="Comando da terminale su MacOS e Linux"
curl -LsSf https://astral.sh/uv/install.sh | sh
```

Su **Linux** puoi decidere se utilizzare lo stesso comando disponibile per MacOS oppure affidarti al pacchetto disponibile 
nella tua distro!!!


## Creare un progetto

Comando semplicissimo:

``` bash
$ uv init --opzione nomeProgetto
```

dove `opzione` Ã¨ una delle seguenti (ho citato solo le 3 piÃ¹ comuni):


| Opzione         | Build System  | Struttura    | Punto di accesso | Distribuzione          | Casi d'uso                               |
|-----------------|:-------------:|--------------|------------------|------------------------|------------------------------------------|
| --app (default) | no            | flat         | `main.py`        | non inteso             | Web apps, script                         |
| --lib           | sÃ¬            | `src` layout | (nessuno)        | PyPi                   | Librerie riutilizzabili                  |
| --package       | sÃ¬            | `src` layout | console script   | app installabili, PyPi | CLI, GUI apps                            |


Le app hanno struttura *piatta* ovvero creando una applicazione di nome `prova1` si ottiene la seguente struttura:

``` bash
prova1
â”œâ”€â”€ .git
â”œâ”€â”€ .gitignore
â”œâ”€â”€ main.py
â”œâ”€â”€ pyproject.toml
â”œâ”€â”€ .python-version
â””â”€â”€ README.md
```

Librerie e pacchetti hanno una struttura con la cartella dei sorgenti, quindi creando un pacchetto di nome `prova2` si ottiene la seguente struttura:

``` bash
prova2
â”œâ”€â”€ .git
â”œâ”€â”€ .gitignore
â”œâ”€â”€ pyproject.toml
â”œâ”€â”€ .python-version
â”œâ”€â”€ README.md
â””â”€â”€ src
    â””â”€â”€ prova2
        â””â”€â”€ __init__.py
```

Notate che in entrambi sono giÃ  presenti un repository `git` e un file per il controllo della versione Python in uso.


## Gestire un ambiente virtuale

La gestione degli ambienti virtuali con `uv` Ã¨ estremamente semplice e, nella maggior parte dei casi, completamente automatica!

### Creazione automatica

Quando crei un nuovo progetto con `uv init`, l'ambiente virtuale **non** viene creato immediatamente. VerrÃ  creato automaticamente al primo comando che ne ha bisogno, ad esempio:

```bash
$ cd prova1
$ uv add requests
```

Questo comando:
1. Crea automaticamente l'ambiente virtuale nella cartella `.venv`
2. Installa il pacchetto `requests` e le sue dipendenze
3. Aggiorna il file `pyproject.toml` con la nuova dipendenza


### Sincronizzare l'ambiente

Se hai scaricato un progetto giÃ  esistente (ad esempio da Git) e vuoi ricreare l'ambiente virtuale con tutte le dipendenze, usa:

```bash
$ uv sync
```

Questo comando legge il file `pyproject.toml` e installa tutti i pacchetti necessari.


### Eseguire script nell'ambiente virtuale

Per eseguire il tuo codice Python usando l'ambiente virtuale del progetto:

```bash
$ uv run main.py
```

oppure per eseguire un comando qualsiasi nell'ambiente:

```bash
$ uv run python script.py
$ uv run pytest
```

Il comando `uv run` si occupa automaticamente di:
- Attivare l'ambiente virtuale
- Eseguire il comando
- Disattivare l'ambiente al termine


### Gestire i pacchetti

Per aggiungere un pacchetto al progetto:

```bash
$ uv add nome-pacchetto
```

Per aggiungere un pacchetto solo per lo sviluppo (testing, linting, etc.):

```bash
$ uv add --dev pytest
```

Per rimuovere un pacchetto:

```bash
$ uv remove nome-pacchetto
```

Per vedere tutti i pacchetti installati:

```bash
$ uv pip list
```


### Lock file

`uv` crea automaticamente un file `uv.lock` che contiene le versioni esatte di tutti i pacchetti installati. Questo garantisce che chiunque scarichi il progetto avrÃ  esattamente le stesse versioni dei pacchetti, evitando problemi di compatibilitÃ .

**Importante:** Aggiungi `uv.lock` al controllo di versione (Git) per condividere l'ambiente esatto con quelli che collaborano con te!



## Installare Python (per il tuo progetto)

SÃ¬... Ã¨ vero... non lo avevo ancora detto. Fino a qui potresti anche **non avere Python** installato nel tuo computer! 

`uv` puÃ² scaricare e gestire versioni di Python in modo completamente indipendente dal sistema operativo. Ogni progetto puÃ² usare la sua versione specifica di Python, senza conflitti con altri progetti o con l'installazione di sistema.

Per *installare una versione specifica* di Python:

```bash
$ uv python install 3.12
```

Questo scarica e installa Python 3.12 in una cartella gestita da `uv` (non nel sistema).

Per installare piÃ¹ versioni contemporaneamente:

```bash
$ uv python install 3.11 3.12 3.13
```


Per vedere *tutte le versioni di Python che puoi installare*:

```bash
$ uv python list --all-versions
```

Per vedere *solo le versioni giÃ  installate* nel tuo sistema:

```bash
$ uv python list
```

### Specificare la versione per il progetto

Quando crei un nuovo progetto, puoi specificare quale versione di Python vuoi usare:

```bash
$ uv init --python 3.12 mio-progetto
```

Questo comando:
1. Crea il progetto `mio-progetto`
2. Crea il file `.python-version` con `3.12` al suo interno
3. Se Python 3.12 non Ã¨ installato, lo scarica automaticamente


Se vuoi cambiare la versione di Python in un progetto giÃ  creato:

```bash
$ cd mio-progetto
$ uv python pin 3.13
```

Questo aggiorna il file `.python-version` e da quel momento tutti i comandi `uv run` useranno Python 3.13.


Puoi eseguire un singolo comando con una versione specifica di Python senza modificare il progetto:

```bash
$ uv run --python 3.11 python script.py
```

### Il file .python-version

Il file `.python-version` contiene semplicemente la versione di Python richiesta dal progetto, ad esempio:

```
3.12
```

`uv` legge automaticamente questo file e usa la versione corretta. Se la versione non Ã¨ installata, `uv` la scarica automaticamente al primo utilizzo!


### Vantaggi di questo approccio

- **Isolamento totale**: ogni progetto ha la sua versione di Python
- **RiproducibilitÃ **: chiunque scarichi il progetto avrÃ  la stessa versione
- **FacilitÃ **: non devi preoccuparti di installare Python manualmente
- **FlessibilitÃ **: puoi testare il codice su versioni diverse semplicemente cambiando il file `.python-version`


Ad esempio...

Immagina di voler creare un progetto che usa Python 3.14 (l'ultima versione oggi):

```bash
$ uv init --python 3.14 nuovo-progetto
$ cd nuovo-progetto
$ uv add requests
$ uv run main.py
```

Se Python 3.14 non Ã¨ installato, `uv` lo scaricherÃ  automaticamente prima di procedere. Facile no? ðŸ˜„
